# Implementation Plan: RAG Chatbot Backend

**Branch**: `002-rag-chatbot-backend` | **Date**: 2025-12-05 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `specs/002-rag-chatbot-backend/spec.md`

## Summary

This plan outlines the creation of a Python-based FastAPI backend service to function as a RAG (Retrieval-Augmented Generation) "Brain" for the interactive textbook. The service will ingest markdown content from the textbook, store it in a vector database, and expose an API endpoint to answer user questions based on the content of a specific chapter.

## Technical Context

**Language/Version**: Python 3.11
**Primary Dependencies**: FastAPI, Qdrant-client, FastEmbed
**Storage**: Qdrant (in-memory vector database)
**Testing**: pytest
**Target Platform**: Linux server (for deployment)
**Project Type**: Web Application (Backend service)
**Performance Goals**: Average response time for `/ask` endpoint < 2 seconds.
**Constraints**: Ingestion of 1000 markdown files in < 5 minutes.
**Scale/Scope**: The service will handle content for the entire textbook and serve a moderate number of concurrent users.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **Spec-Driven Development**: ✅ Plan is derived from an approved spec.
- **Reusable Skills (Subagents)**: ⚠️ The ingestion logic and the "Brain" logic are good candidates for being separate, reusable skills. The current plan will implement them as modules within the API, but they should be designed for future extraction.
- **Context-Aware RAG for Chatbot**: ✅ The plan explicitly requires filtering by `chapter_id`.
- **Library-First**: ⚠️ This feature is being built as a service within the existing repository, not as a standalone library. This is a justified deviation as it's a core backend service, not a reusable component for other projects.
- **CLI Interface**: ⚠️ The ingestion script can be exposed as a CLI tool, but the main `/ask` functionality is API-based.
- **Test-First (NON-NEGOTIABLE)**: ✅ The plan includes using `pytest`, and development will follow TDD.

## Project Structure

### Documentation (this feature)

```text
specs/002-rag-chatbot-backend/
├── plan.md              # This file
├── research.md          # To be generated
├── data-model.md        # To be generated
├── quickstart.md        # To be generated
├── contracts/           # To be generated
└── tasks.md             # To be generated by /sp.tasks
```

### Source Code (repository root)

```text
api/
├── src/
│   ├── main.py         # FastAPI app, /ask endpoint
│   ├── ingest.py       # Ingestion script
│   ├── core/           # Core logic, e.g., embedding, Qdrant interaction
│   └── models/         # Pydantic models for API
└── tests/
    ├── test_main.py
    └── test_ingest.py
```

**Structure Decision**: A new `api/` directory will be created at the root of the repository to house the backend service, as specified in the requirements. This keeps it separate from the `web/` frontend.

## Complexity Tracking

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| Not a standalone library | The backend is a core service tightly coupled with the book's content and frontend. | Creating it as a separate library would add unnecessary complexity for deployment and integration at this stage. |
| No CLI for `/ask` | The primary user interaction is through the web interface, which will call the API. | A CLI for asking questions is not a primary user scenario. The ingestion script will be a CLI tool. |