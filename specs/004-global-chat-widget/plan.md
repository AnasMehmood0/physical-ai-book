# Implementation Plan: Global Fixed Chat Widget (Corner Bubble)

**Branch**: `004-global-chat-widget` | **Date**: 2025-12-06 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `specs/004-global-chat-widget/spec.md`

## Summary

This plan outlines the creation and integration of a React-based global fixed chat widget (corner bubble) into the Docusaurus website. The widget will provide a togglable interface for users to interact with the AI backend, sending questions and displaying responses across all pages of the site.

## Technical Context

**Language/Version**: TypeScript, React (Docusaurus)
**Primary Dependencies**: React, Docusaurus theme, fetch API (for backend communication)
**Storage**: N/A (Frontend component, no local storage beyond session for chat state if implemented)
**Testing**: Jest, React Testing Library
**Target Platform**: Web Browsers
**Project Type**: Web Application (Frontend component)
**Performance Goals**: Chat interface expands/collapses smoothly within 0.5 seconds.
**Constraints**: Fixed position (bottom-right), minimal bubble icon design, togglable.
**Scale/Scope**: Single global component present on all pages.

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

- **Spec-Driven Development**: ✅ Plan is derived from an approved spec.
- **Reusable Skills (Subagents)**: ✅ The `GlobalChatWidget` is designed as a reusable React component.
- **Context-Aware RAG for Chatbot**: ✅ The widget explicitly sends `chapter_id` to the backend.
- **Library-First**: ⚠️ This is a frontend component integrated directly into the Docusaurus theme, not a standalone library. This is a justified deviation as it's a direct UI element of the application.
- **CLI Interface**: N/A (Frontend UI component).
- **Test-First (NON-NEGOTIABLE)**: ✅ The plan will include testing with Jest/React Testing Library.

## Project Structure

### Documentation (this feature)

```text
specs/004-global-chat-widget/
├── plan.md              # This file
├── research.md          # To be generated
├── data-model.md        # To be generated
├── quickstart.md        # To be generated
├── contracts/           # To be generated
└── tasks.md             # To be generated by /sp.tasks
```

### Source Code (repository root)

```text
web/
├── src/
│   ├── components/
│   │   └── GlobalChatWidget.tsx    # New React component
│   │   └── GlobalChatWidget.module.css # Component specific styles
│   └── theme/
│       └── Layout/
│           └── index.tsx          # Modified Docusaurus Layout (swizzled)
├── src/pages/index.tsx         # Cleaned up (removed old component)
```

**Structure Decision**: The component will reside in `web/src/components/`. Its styles will be co-located using CSS Modules. The global integration will happen by swizzling the Docusaurus `Layout` component.

## Complexity Tracking

| Violation | Why Needed | Simpler Alternative Rejected Because |
|-----------|------------|-------------------------------------|
| Not a standalone library | This is a UI component tightly integrated into the Docusaurus frontend. | Creating it as a completely separate library would add unnecessary overhead for a single-use UI element within the application. |
| No CLI Interface | This is a purely frontend UI component. | A CLI interface is not applicable for direct user interaction with a visual widget. |